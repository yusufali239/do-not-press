<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Hadis Ilmi - Mustaqil Ish</title>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

  <style>
    :root {
      --primary: #4e54c8;
      --secondary: #8f94fb;
      --bg: #f8fbff;
      --white: #ffffff;
      --light: #f0f4ff;
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #e0e7ff 0%, #c3dafe 100%);
      min-height: 100vh;
      color: #2c3e50;
      padding: 20px;
    }
    .container { max-width: 900px; margin: 0 auto; padding-bottom: 100px; }
    
    .card {
      background: var(--white);
      border-radius: 15px;
      margin-bottom: 15px;
      padding: 20px;
      border: 2px solid transparent;
      cursor: pointer;
      transition: 0.2s;
      box-shadow: 0 4px 10px rgba(0,0,0,0.05);
    }
    .card.selected {
      border-color: var(--primary);
      background: #f4f7ff;
    }
    .card-header { display: flex; align-items: center; gap: 15px; font-weight: bold; }
    .check-icon {
      width: 24px; height: 24px; border: 2px solid #ccc; border-radius: 6px;
      display: flex; align-items: center; justify-content: center;
      color: white; transition: 0.2s;
    }
    .card.selected .check-icon { background: var(--primary); border-color: var(--primary); }

    .btn {
      padding: 12px 25px; border: none; border-radius: 50px;
      color: white; font-weight: bold; cursor: pointer;
      background: var(--primary); display: inline-flex; align-items: center; gap: 8px;
    }
    .btn:disabled { background: #ccc; cursor: not-allowed; }
    
    .action-bar {
      position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
      background: white; padding: 15px 30px; border-radius: 50px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
      display: flex; gap: 15px; z-index: 100;
    }

    input[type="text"] {
      width: 100%; padding: 15px; margin-bottom: 20px;
      border: 1px solid #ddd; border-radius: 10px; font-size: 16px;
    }
    .editable-box {
      background: white; padding: 20px; border-radius: 10px; margin-bottom: 20px;
      border: 2px dashed #ccc;
    }

    .loader {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(255,255,255,0.98); 
      display: none; flex-direction: column;
      align-items: center; justify-content: center; z-index: 9999;
    }
    .loader.active { display: flex; }
    .spinner {
      width: 50px; height: 50px; border: 5px solid #eee;
      border-top: 5px solid var(--primary); border-radius: 50%;
      animation: spin 1s linear infinite; margin-bottom: 20px;
    }
    @keyframes spin { 100% { transform: rotate(360deg); } }

    #pdfOutput {
      display: none; 
      background: white;
      width: 750px;
      padding: 40px;
      color: black;
      font-family: 'Times New Roman', serif;
    }
    
    .pdf-header { text-align: center; border-bottom: 2px solid #000; padding-bottom: 20px; margin-bottom: 30px; }
    .pdf-topic { margin-bottom: 30px; page-break-inside: auto; }
    .pdf-title { color: #000; font-size: 16pt; font-weight: bold; margin-bottom: 10px; }
    .pdf-text { font-size: 12pt; line-height: 1.5; text-align: justify; }
    .pdf-highlight { 
        background-color: #f0f0f0; 
        padding: 10px; 
        border-left: 3px solid #000; 
        margin: 10px 0; 
        font-weight: bold;
    }

  </style>
</head>
<body>

  <div class="loader" id="loader">
    <div class="spinner"></div>
    <h3>PDF tayyorlanmoqda...</h3>
  </div>

  <div class="container" id="appContainer">
    <div style="text-align:center; margin-bottom:30px;">
      <h1 style="color:var(--primary);">ðŸ“š Hadis Ilmi - Mustaqil Ish</h1>
    </div>

    <input type="text" id="studentName" placeholder="F.I.O va Guruhingizni yozing (Masalan: Aliyev Vali, 304-guruh)" />

    <div id="selectionSection">
      <div id="topicsContainer"></div>
      <div class="action-bar">
        <button class="btn" onclick="toggleSelectAll()">Hammasi</button>
        <button class="btn" id="nextBtn" onclick="goToEditor()" disabled>Davom etish</button>
      </div>
    </div>

    <div id="editorSection" style="display:none;">
      <div id="editorContainer"></div>
      
      <div class="editable-box">
        <h4>Xulosa:</h4>
        <div id="finalConclusion" contenteditable="true">
          Ushbu mavzularni o'rganib, men hadis ilmining nozik jihatlarini tushundim...
        </div>
      </div>

      <div class="action-bar">
        <button class="btn" style="background:#777" onclick="backToSelection()">Ortga</button>
        <button class="btn" onclick="generatePDF()">PDF YUKLAB OLISH</button>
      </div>
    </div>
  </div>

  <div id="pdfWrapper" style="position: absolute; top: 0; left: 0; width: 100%; z-index: -1;">
     <div id="pdfOutput"></div>
  </div>

  <script>
    const topics = [
      { id: 1, title: "Hanafiylarning taqsimoti", content: `<p><b>Hanafiy imomlarimiz xabarlarni uch qismga bo'lishgan:</b></p><div class='pdf-highlight'><b>1. MUTAVOTIR:</b> Surat va ma'no jihatidan shubhasiz, to'liq bog'lanishga ega xabar.</div><div class='pdf-highlight'><b>2. MASHHUR:</b> Sahobalar davrida ahod, keyin tobi'inlar davrida mutavotir bo'lgan.</div><div class='pdf-highlight'><b>3. AHOD:</b> Har ikki jihatdan shubhali xabar.</div>` },
      { id: 2, title: "Muhaddislarning taqsimoti", content: `<p><b>Muhaddislar ikki qismga:</b> Mutavotir va Xabarul-vohid.</p><p>Xabarul-vohid uch turga: mashhur, aziz, g'arib.</p><div class='pdf-highlight'>Ibn Hajar va Ibn Humom ikki istiloh farqiga e'tibor qaratgan.</div>` },
      { id: 3, title: "Ikki istilohni solishtirish", content: `<p><b>Har bir guruh o'z faniga mos yo'l tanlagan:</b></p><div class='pdf-highlight'>MUHADDISLAR: Isnodga e'tibor, roviylar soniga qarab bo'lishgan.</div><div class='pdf-highlight'>FAQIHLAR: Matnga e'tibor, amal qilish jihatidan bo'lishgan.</div>` },
      { id: 4, title: "Mutavotir ta'rifi", content: `<p><b>LUG'AVIY:</b> Ketma-ket kelish.</p><div class='pdf-highlight'><b>ISTILOHDA:</b> O'z-o'zidan ilm hosil qiladigan jamoa xabari (Imom Ibn as-Sa'atiy).</div><p>Hanafiy muhaqqiqlar (Abdulaziz al-Buxoriy, Ibn Humom) bu ta'rifni afzal ko'rgan.</p>` },
      { id: 5, title: "Mutavotir shartlari", content: `<div class='pdf-highlight'><b>1-SHART:</b> Ko'plik - yolg'onda kelishish imkonsiz.</div><div class='pdf-highlight'><b>2-SHART:</b> Barcha tabaqalarda ko'plik (3 asr).</div><div class='pdf-highlight'><b>3-SHART:</b> Hissiyotga asoslanish (aqliy emas).</div>` },
      { id: 6, title: "Mutavotir hukmi", content: `<div class='pdf-highlight'><b>ZARURIY ILM BERADI! Inkor qilgan KOFIR.</b></div><p><b>QozÃ„Â± Iso:</b> "Kim rad etsa, Rasululloh ï·º ni rad etgandek."</p><div class='pdf-highlight'>Aniq son shart emas, mezon - ilm hosil bo'lishi.</div>` },
      { id: 7, title: "Mutavotir turlari", content: `<p><b>Imom Kashmiri to'rt qismga:</b></p><p>1. Isnod mutavotiri<br>2. Tabaqa mutavotiri<br>3. Amal va meros mutavotiri<br>4. Umumiy qadr mutavotiri</p>` },
      { id: 8, title: "Mashhur ta'rifi", content: `<div class='pdf-highlight'><b>Birinchi asrda ahod, ikkinchi va uchinchi asrlarda mutavotir bo'lgan xabar.</b></div><p>Uch asrdan keyin mashhurlik e'tiborga olinmaydi!</p>` },
      { id: 9, title: "Uch asr chegarasi", content: `<div class='pdf-highlight'><b>1-ASR:</b> Sahobalar (110 h.y.)</div><div class='pdf-highlight'><b>2-ASR:</b> Tobi'inlar (180 h.y.)</div><div class='pdf-highlight'><b>3-ASR:</b> Tabe't-tobi'in (220 h.y.)</div>` },
      { id: 10, title: "Mashhur hukmi", content: `<div class='pdf-highlight'>Mutavotir va ahod o'rtasida. "Tuma'nina" (xotirjamlik) beradi.</div><p>Inkor qilgan KOFIR emas, ADASHGAN.</p>` },
      { id: 11, title: "Ahod ta'rifi", content: `<div class='pdf-highlight'>Mashhur va mutavotirga yetmagan har qanday xabar.</div><p>Istilohdagi va lug'aviy ma'no har doim mos kelmaydi!</p>` },
      { id: 12, title: "Ahod hukmi", content: `<div class='pdf-highlight'>ILM BERMAYDI, AMAL QILISHNI VOJIB qiladi.</div><p><b>Saraxsiy:</b> "Amalni vojib qiladi, ilmni emas."</p>` },
      { id: 13, title: "Hudud masalasi", content: `<div class='pdf-highlight'><b>ROJIH:</b> Hudud ahod bilan isbotlanadi (Abu Yusuf, ko'pchilik).</div><p>"Hududni shubha bilan daf eting" - sababdagi shubha, dalildagi emas!</p>` },
      { id: 14, title: "Aql sharti", content: `<div class='pdf-highlight'>To'liq aql - balog'at bilan hosil bo'ladi.</div><p>Bolaning rivoyati hujjat emas.</p>` },
      { id: 15, title: "Balog'at - ado sharti", content: `<div class='pdf-highlight'>Balog'at ADO ETISH sharti, TAHAMMUL sharti emas!</div><p>Ibn Abbos 13, Ibn Zubayr 10, Nu'mon 8 yoshda eshitgan.</p>` },
      { id: 16, title: "Tahammul yoshi", content: `<div class='pdf-highlight'>Yosh bilan belgilanmaydi. Mezon - tushunish!</div><p>5 yoshdan kichik tushunsa - sahih.</p>` },
      { id: 17, title: "Islom sharti", content: `<div class='pdf-highlight'>Roviy musulmon bo'lishi shart. Kofirning rivoyati qabul qilinmaydi.</div><p>Sabab - dushmanlik gumoni.</p>` },
      { id: 18, title: "Islom - ado vaqtida", content: `<div class='pdf-highlight'>Islom ADO ETISH vaqtida shart, TAHAMMUL vaqtida emas!</div><p>Kofir eshitib, keyin musulmon bo'lsa - qabul qilinadi.</p>` },
      { id: 19, title: "Zabt ta'rifi", content: `<div class='pdf-highlight'>To'g'ri eshitish, tushunish, saqlash va barqaror tutish.</div><p>Zabt xatodan ustun bo'lishi kerak!</p>` },
      { id: 20, title: "Zabt turlari", content: `<div class='pdf-highlight'><b>ZOHIRIY:</b> Lafz va lug'aviy ma'no (SHART).</div><div class='pdf-highlight'><b>BOTINIY:</b> Fiqhiy ma'no, faqih bo'lish (AFZALLIK).</div><p>Sadr zabti / Kitob zabti.</p>` },
      { id: 21, title: "G'ofil roviy", content: `<p>Hushyorlik ustun bo'lsa - qabul qilinadi.</p><div class='pdf-highlight'>G'aflat ustun bo'lsa - qabul qilinmaydi!</div>` },
      { id: 22, title: "Zabtli roviy tanish", content: `<div class='pdf-highlight'>1. Shuhrat<br>2. Zabtli roviylarga muvofiqligi</div>` },
      { id: 23, title: "Adolat ta'rifi", content: `<div class='pdf-highlight'>Taqvo va muruwwatga undaydigan mustahkam sifat.</div><p>Hadisda: Katta gunohlarni tark etish yetarli.</p>` },
      { id: 24, title: "Hadisda adolat", content: `<div class='pdf-highlight'>1. Katta gunohlarni tark<br>2. Kichik gunohlarda turib olmaslik<br>3. Muruwwatni buzmaslik</div>` },
      { id: 25, title: "Adolat turlari", content: `<div class='pdf-highlight'><b>ZOHIRIY:</b> Islomning zohiri bilan.</div><div class='pdf-highlight'><b>BOTINIY:</b> Haqiqiy daraja (ikkisi ham shart!).</div>` },
      { id: 26, title: "Nabiyga yolg'on", content: `<div class='pdf-highlight'>1-QARASH: Hech qachon qabul qilinmaydi (jazo).</div><p>2-QARASH: Tavba qilsa qabul qilinadi.</p>` },
      { id: 27, title: "Adolatli roviydan rivoyat", content: `<div class='pdf-highlight'>HANAFIYLAR: Uch asrda ta'dil, keyin yo'q!</div>` },
      { id: 28, title: "Mubham ta'dil", content: `<div class='pdf-highlight'>Hanafiylar: "Ishonchli kishi aytdi" - uch asrda qabul qilinadi!</div>` },
      { id: 29, title: "Bid'at ta'rifi", content: `<div class='pdf-highlight'>Sahoba yo'lida bo'lmagan, shariat talab qilmagan yangilik.</div><p>Ikki turi: Kufrga va Fisqqa olib boruvchi.</p>` },
      { id: 30, title: "Bid'atchi rivoyati", content: `<p><b>1-MAZHAB (Saraxsiy):</b> Mutlaqo qabul qilinmaydi.</p><p><b>2-MAZHAB (Ibn Humom):</b> Yolg'onni halol sanamaasa - qabul qilinadi.</p><p><b>3-MAZHAB (Ibn Hajar):</b> Da'vat qilmasa - qabul qilinadi.</p>` },
      { id: 31, title: "Buxoriy va xorijiylar", content: `<div class='pdf-highlight'>Buxoriy xorijiylardan (Imron) hadis olgan - u hadisda ayblangan emas edi!</div>` },
      { id: 32, title: "Majhul - kirish", content: `<p><b>Muhammad 'Avvoma:</b> "Hanafiylar 'majhul'ini bayon qilish zarur - odamlar aralashtirib yuborishgan!"</p><div class='pdf-highlight'>Birinchi gapirgan: QozÃ„Â± Iso ibn Abon (221 h.y.) - Imom Muhammad shogirdi.</div>` },
      { id: 33, title: "Roviylarning 3 toifasi", content: `<div class='pdf-highlight'><b>1-TOIFA:</b> Rivoyat va fiqh bilan tanilgan - qabul qilinadi.</div><div class='pdf-highlight'><b>2-TOIFA:</b> Faqat rivoyat bilan tanilgan - qabul qilinadi.</div><div class='pdf-highlight'><b>3-TOIFA:</b> MAJHUL - kam tanilgan (5 turga bo'linadi).</div>` },
      { id: 34, title: "Hanafiylar nazarida majhul", content: `<div class='pdf-highlight'>Hadis rivoyati bilan mashhur emas, kam rivoyat qilgan roviy.</div><p>"Bir yoki ikki hadis" - kamlikni ifodalash!</p>` },
      { id: 35, title: "Majhulga misollar", content: `<p>Vobisa: 8 hadis, 18 kishi<br>Ma'qil: 4 hadis, 9 kishi<br>Salama: 7 hadis, 5 kishi</p><div class='pdf-highlight'>Undan kimlar rivoyat qilgani ahamiyatsiz!</div>` },
      { id: 36, title: "Mastur = Majhul", content: `<div class='pdf-highlight'>Abdulaziz al-Buxoriy: "Majhul va mastur - bitta!"</div><p>Faqat 3 asr "majhul", keyingisi "mastur".</p>` },
      { id: 37, title: "Muhaddislar istilohi", content: `<p>Majhul al-'ayn: 1 kishi rivoyat qilgan.<br>Majhul al-hol (mastur): 2+ kishi, lekin ta'dil/jarh yo'q.</p><div class='pdf-highlight'>Hanafiylar: rivoyatlari kami muhim. Muhaddislar: kimlar rivoyat qilgani muhim.</div>` },
      { id: 38, title: "Majhul 5 qismi - 1,2", content: `<div class='pdf-highlight'><b>1-QISM:</b> Salaf qabul qilgan - QABUL QILINADI!</div><div class='pdf-highlight'><b>2-QISM:</b> Salaf sukut qilgan - QABUL QILINADI!</div>` },
      { id: 39, title: "Majhul 5 qismi - 3", content: `<div class='pdf-highlight'><b>3-QISM:</b> Ixtilof qilingan - QIYOSGA MOS KELSA QABUL QILINADI!</div><p><b>MISOL:</b> Ma'qil ibn Sinon - Ibn Mas'ud qabul, Ali rad etgan.</p>` },
      { id: 40, title: "Majhul 5 qismi - 4,5", content: `<div class='pdf-highlight'><b>4-QISM:</b> Salaf rad etgan - RAD ETILADI!</div><div class='pdf-highlight'><b>5-QISM:</b> Salaf bilmagan - VOJIB EMAS, qiyosga mos kelsa JOIZ!</div>` },
      { id: 41, title: "Saraxsiy bayoni", content: `<p>"5-qism bilan amal qilish vojib emas, qiyosga mos kelsa joiz. Chunki birinchi davrda adolat ustun. Lekin salaf bilmagani uchun xato ehtimoli bor."</p><div class='pdf-highlight'>Shariatda vojiblik bunday zaif yo'l bilan sobit bo'lmaydi!</div>` },
      { id: 42, title: "Abu Hanifa va mastur", content: `<p>"Abu Hanifa mastur guvoh bilan hukm qilishni joiz ko'rgan, vojib qilmagan. U 3-asrda yashagan, o'sha davrda adolat ustun."</p><div class='pdf-highlight'>Bizning zamonimizda: qabul qilinmaydi, fisq ustun!</div>` },
      { id: 43, title: "Xulosa - Majhul", content: `<div class='pdf-highlight'><b>1.</b> 3 asr "MAJHUL", keyin "MASTUR".</div><div class='pdf-highlight'><b>2.</b> Ikkalasi aslida BITTA.</div><div class='pdf-highlight'><b>3.</b> 3 asr majhuli tafsilot bilan qabul qilinadi (vojib emas, joiz).</div><div class='pdf-highlight'><b>4.</b> SHART: Qiyosga mos bo'lishi. 3 asrdan keyingi mastur - qabul qilinmaydi!</div>` }
    ];

    let selected = [];
    let edits = {};

    window.addEventListener('DOMContentLoaded', () => {
      const cont = document.getElementById('topicsContainer');
      cont.innerHTML = topics.map(t => `
        <div class="card" id="card-${t.id}" onclick="toggle(${t.id})">
          <div class="card-header">
            <div class="check-icon" id="check-${t.id}"><i class="fa fa-check"></i></div>
            <span>${t.id}. ${t.title}</span>
          </div>
        </div>
      `).join('');
    });

    function toggle(id) {
      if(selected.includes(id)) selected = selected.filter(x => x !== id);
      else selected.push(id);
      
      topics.forEach(t => {
         const el = document.getElementById(`card-${t.id}`);
         const ic = document.getElementById(`check-${t.id}`);
         if(selected.includes(t.id)) {
           el.classList.add('selected');
           ic.style.background = '#4e54c8';
           ic.style.borderColor = '#4e54c8';
         } else {
           el.classList.remove('selected');
           ic.style.background = 'transparent';
           ic.style.borderColor = '#ccc';
         }
      });
      document.getElementById('nextBtn').disabled = selected.length === 0;
    }

    function toggleSelectAll() {
      if(selected.length === topics.length) selected = [];
      else selected = topics.map(t => t.id);
      
      topics.forEach(t => {
         const el = document.getElementById(`card-${t.id}`);
         const ic = document.getElementById(`check-${t.id}`);
         if(selected.includes(t.id)) {
           el.classList.add('selected');
           ic.style.background = '#4e54c8';
         } else {
           el.classList.remove('selected');
           ic.style.background = 'transparent';
         }
      });
      document.getElementById('nextBtn').disabled = selected.length === 0;
    }

    function goToEditor() {
      const name = document.getElementById('studentName').value;
      if(!name) return alert("Ismingizni kiriting!");

      document.getElementById('selectionSection').style.display = 'none';
      document.getElementById('editorSection').style.display = 'block';

      const cont = document.getElementById('editorContainer');
      cont.innerHTML = '';
      
      selected.sort((a,b)=>a-b).forEach(id => {
        const t = topics.find(x => x.id === id);
        const div = document.createElement('div');
        div.className = 'editable-box';
        div.innerHTML = `
          <h4 style="color:#888; margin-bottom:10px">${t.title}</h4>
          <div id="edit-${id}" contenteditable="true" style="outline:none">${edits[id] || t.content}</div>
        `;
        cont.appendChild(div);
      });
    }

    function backToSelection() {
      document.getElementById('selectionSection').style.display = 'block';
      document.getElementById('editorSection').style.display = 'none';
    }

    function generatePDF() {
      selected.forEach(id => {
        const el = document.getElementById(`edit-${id}`);
        if(el) edits[id] = el.innerHTML;
      });
      const conclusion = document.getElementById('finalConclusion').innerHTML;
      const name = document.getElementById('studentName').value;

      const output = document.getElementById('pdfOutput');
      output.innerHTML = `
        <div class="pdf-header">
          <h1>MUSTAQIL ISH</h1>
          <h3>Mavzu: Hadis ilmi (Mustalahul hadis)</h3>
          <p style="margin-top:15px"><strong>Bajardi:</strong> ${name}</p>
          <p><strong>Sana:</strong> ${new Date().toLocaleDateString()}</p>
        </div>
      `;

      selected.forEach(id => {
        const t = topics.find(x => x.id === id);
        output.innerHTML += `
          <div class="pdf-topic">
            <div class="pdf-title">${t.id}. ${t.title}</div>
            <div class="pdf-text">${edits[id] || t.content}</div>
          </div>
        `;
      });

      output.innerHTML += `
        <div style="margin-top:40px; border-top:2px solid #000; padding-top:20px;">
          <h3>XULOSA</h3>
          <div class="pdf-text">${conclusion}</div>
        </div>
      `;

      const loader = document.getElementById('loader');
      loader.classList.add('active');

      output.style.display = 'block';
      
      const opt = {
        margin:       15,
        filename:     `${name.replace(/\s/g, '_')}_Mustaqil_Ish.pdf`,
        image:        { type: 'jpeg', quality: 0.98 },
        html2canvas:  { scale: 2, useCORS: true },
        jsPDF:        { unit: 'mm', format: 'a4', orientation: 'portrait' }
      };

      setTimeout(() => {
        html2pdf().set(opt).from(output).save().then(() => {
          loader.classList.remove('active');
          output.style.display = 'none';
          alert("PDF Muvaffaqiyatli yuklandi!");
        }).catch(err => {
          loader.classList.remove('active');
          output.style.display = 'none';
          alert("Xatolik: " + err.message);
        });
      }, 500);
    }
  </script>
</body>
</html>
