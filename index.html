<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mustaqil Ish: Usul al-Fiqh (To'liq Tahrir)</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #34495e;
            --accent: #3498db;
            --light: #f8f9fa;
            --border: #e9ecef;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f0f2f5;
            margin: 0;
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        /* Chap Panel - Menyu */
        .sidebar {
            width: 350px;
            background: white;
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            padding: 20px;
            overflow-y: auto;
            box-shadow: 2px 0 5px rgba(0,0,0,0.05);
        }

        .student-form input {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }

        .topics-tree {
            margin-top: 20px;
        }

        .chapter-title {
            font-weight: bold;
            color: var(--primary);
            margin-top: 15px;
            margin-bottom: 5px;
            padding-bottom: 5px;
            border-bottom: 2px solid var(--accent);
            font-size: 0.95em;
        }

        .topic-item {
            display: flex;
            align-items: flex-start;
            margin-bottom: 8px;
            font-size: 0.9em;
            padding: 5px;
            border-radius: 4px;
            transition: background 0.2s;
        }

        .topic-item:hover {
            background-color: var(--light);
        }

        .topic-item input {
            margin-top: 3px;
            margin-right: 10px;
        }

        /* O'ng Panel - Tahrirlash */
        .main-content {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
            background-color: #f0f2f5;
        }

        .editor-container {
            max-width: 800px;
            margin: 0 auto;
        }

        .info-card {
            background: white;
            padding: 25px;
            margin-bottom: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            border-bottom: 1px solid var(--border);
            padding-bottom: 10px;
        }

        .card-title {
            font-weight: bold;
            color: var(--primary);
            font-size: 1.1em;
        }

        .remove-btn {
            color: #e74c3c;
            cursor: pointer;
            font-size: 0.9em;
            border: none;
            background: none;
        }

        textarea.editable-area {
            width: 100%;
            min-height: 150px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-family: inherit;
            font-size: 1em;
            line-height: 1.6;
            resize: vertical;
            background-color: #fafafa;
            box-sizing: border-box;
        }

        textarea.editable-area:focus {
            outline: 2px solid var(--accent);
            background-color: white;
        }

        .action-bar {
            position: sticky;
            bottom: 20px;
            text-align: right;
            margin-top: 20px;
        }

        .btn-pdf {
            background-color: #27ae60;
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 50px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(39, 174, 96, 0.3);
            transition: transform 0.2s;
        }

        .btn-pdf:hover {
            transform: scale(1.05);
        }

        /* PDF Preview Styles (Hidden) */
        #pdf-template {
            display: none;
            padding: 40px;
            font-family: 'Times New Roman', serif;
        }
        
        .pdf-header { text-align: center; border-bottom: 2px solid black; margin-bottom: 20px; }
        .pdf-student { margin-bottom: 30px; font-weight: bold; }
        .pdf-section { margin-bottom: 20px; text-align: justify; }
        .pdf-section h3 { background-color: #eee; padding: 5px; font-size: 14pt; }
        .pdf-content { font-size: 12pt; line-height: 1.5; white-space: pre-wrap; }

    </style>
</head>
<body>

<div class="sidebar">
    <h2 style="text-align:center; color: var(--primary);">Mavzular</h2>
    
    <div class="student-form">
        <label>F.I.SH:</label>
        <input type="text" id="inpName" placeholder="Abdullayev Anvar">
        <label>Kurs va Guruh:</label>
        <input type="text" id="inpCourse" placeholder="4-A">
    </div>

    <div class="topics-tree" id="topicsMenu">
        </div>
</div>

<div class="main-content">
    <div class="editor-container">
        <h1 style="color: var(--primary); text-align: center;">Mustaqil Ish Tahrirchisi</h1>
        <p style="text-align: center; color: #7f8c8d;">Chap tarafdan mavzuni tanlang. Matn o'ng tarafda paydo bo'ladi. Uni o'qib, o'zgartirib, xulosa yozishingiz mumkin.</p>
        
        <div id="cards-area">
            </div>

        <div class="action-bar">
            <button class="btn-pdf" onclick="generatePDF()">PDF YUKLAB OLISH</button>
        </div>
    </div>
</div>

<div id="pdf-template">
    <div class="pdf-header">
        <h1>MUSTAQIL ISH</h1>
        <p>Fan: Usul al-Fiqh / Hadisshunoslik</p>
    </div>
    <div class="pdf-student">
        <p>Talaba: <span id="pdf-name"></span></p>
        <p>Guruh: <span id="pdf-course"></span></p>
    </div>
    <div id="pdf-body">
        </div>
</div>

<script>
    // ==========================================
    // 1. TO'LIQ MA'LUMOTLAR BAZASI (MANBADAN)
    // ==========================================
    const fullData = [
        {
            chapter: "1-BOB: Xabarlarning bo'linishi",
            topics: [
                {
                    id: "1.1",
                    title: "Hanafiylarning taqsimoti (Mutavotir, Mashhur, Ahod)",
                    text: "Hanafiy imomlarimiz Rasululloh (s.a.v)ga bog'lanish (ittisol) jihatidan xabarlarni uch qismga bo'lishgan:\n\n1. Mutavotir xabar: Surat jihatidan ham, ma'no jihatidan ham mutlaqo shubhasiz, to'liq bog'lanishga ega bo'lgan xabar. Undagi bog'lanish to'liq bo'lib, hech qanday shubha yo'q.\n\n2. Mashhur xabar: Surat jihatidan shubha bor, chunki u sahobalar davrida ahod bo'lgan. Ammo ma'no jihatidan shubha yo'q, chunki u ikkinchi va uchinchi asrlarda (tobi'in va tobi'ut-tobi'in davrida) mutavotir bo'lib, ummat tomonidan qabul qilingan.\n\n3. Ahod xabar (Xabarul-vohid): Surat jihatidan ham, ma'no jihatidan ham shubha bor. Chunki u birinchi asrda ahod bo'lgan, keyin ham mutavotir bo'lmagan."
                },
                {
                    id: "1.2",
                    title: "Muhaddislarning taqsimoti",
                    text: "Muhaddislarning aksariyatiga koʻra xabarlar ikki qismga bo'linadi:\n1. Mutavotir xabar.\n2. Xabarul-vohid.\n\nSo'ng xabarul-vohid o'z navbatida uch qismga bo'linadi: Mashhur, Aziz, G'arib.\n\nIbn Hajar 'Nuxbatul-fikar' asarida va Xatib Bag'dodiy ham shu taqsimotni keltirgan. Hanafiy ulamolaridan Ibn Humom va Muhammad Akram as-Sindi ikki istiloh o'rtasidagi farqqa e'tibor qaratib, hanafiylarda 'Mashhur' alohida qism ekanini ta'kidlaganlar."
                },
                {
                    id: "1.3",
                    title: "Hanafiy va Muhaddis istilohlarini solishtirish",
                    text: "Har bir guruh o'z faniga mos yo'lni tanlagan:\n- Muhaddislarning maqsadi isnod bo'lib, ular roviylar soniga qarab bo'lishgan.\n- Faqihlarning maqsadi matn va unga amal qilish bo'lib, hukm chiqarish jihatidan bo'lishgan.\n\nUmumiy holat: Agar 3+ sahoba rivoyat qilib, keyin mutavotir bo'lib ketsa, bu ikkala mazhabda ham 'Mashhur'dir.\nFarqli holat: Agar 1 sahoba rivoyat qilib, keyin mutavotir bo'lib ketsa -> Hanafiylarda 'Mashhur', Muhaddislarda 'Mashhur' (lekin ahod turi)."
                }
            ]
        },
        {
            chapter: "2-BOB: Mutavotir xabar",
            topics: [
                {
                    id: "2.1",
                    title: "Mutavotir ta'rifi va shartlari",
                    text: "Ta'rifi: Imom Ibn as-Sa'atiy aytadi: 'O'z-o'zidan ilmni hosil qiladigan jamoa xabari'.\n\nHanafiy muhaqqiqlarga ko'ra 3 ta shart mavjud:\n1. Ko'plik: Roviylar soni shunchalik ko'p bo'lishi kerakki, ular yolg'on ustida kelishib olishi aqlan imkonsiz bo'lsin.\n2. Barcha tabaqalarda mavjudlik: Bu ko'plik isnodning boshidan oxirigacha (sahoba, tobi'in, tobi'ut-tobi'in) uzluksiz bo'lishi kerak. Hanafiylarda 3 asr e'tiborga olinadi.\n3. Hissiyotga asoslanish: Xabar aqliy emas, balki ko'rish yoki eshitish kabi sezgiga asoslangan bo'lishi kerak (Masalan, olamning yaratilganligi aqliy, uni mutavotir bilan isbotlab bo'lmaydi)."
                },
                {
                    id: "2.2",
                    title: "Mutavotirning hukmi",
                    text: "Mutavotir xabar zaruriy (qat'iy) ilm beradi. Uni inkor qilgan kishi kofir bo'ladi. Qozı Iso ibn Aban aytadi: 'Kim uni rad etsa, Rasulullohni rad etgandek bo'ladi'.\n\nMutavotirda aniq son shart emas (masalan, 10 yoki 70 ta deb), balki mezon - qalbda ilm va ishonch hosil bo'lishidir."
                }
            ]
        },
        {
            chapter: "3-BOB: Mashhur xabar",
            topics: [
                {
                    id: "3.1",
                    title: "Mashhur xabar ta'rifi va 'Uch Asr' masalasi",
                    text: "Hanafiylar istilohida Mashhur: Birinchi asrda ahod (bitta yoki bir nechta kishi) bo'lib, ikkinchi va uchinchi asrlarda mutavotir darajasiga yetgan xabar.\n\nUch asr (Qarn) chegarasi:\n1. Sahobalar asri (110 h.y.gacha).\n2. Tobi'inlar asri (180 h.y.gacha).\n3. Tobi'ut-tobi'inlar asri (220 h.y.gacha).\n\nUch asrdan keyin yuzaga kelgan mashhurlik hanafiylar nazdida e'tiborga olinmaydi."
                },
                {
                    id: "3.2",
                    title: "Mashhur xabarning hukmi",
                    text: "Mashhur xabar mutavotirdan past, ahoddan yuqori turadi. U 'tuma'nina' (xotirjamlik) hosil qiladigan ilmni beradi, lekin zaruriy (qat'iy) ilmni bermaydi. \n\nUni inkor qilgan kishi kofir bo'lmaydi, balki adashgan (zall) hisoblanadi. Chunki uning asli (birinchi asrda) ahod bo'lgani uchun ozgina shubha mavjud."
                }
            ]
        },
        {
            chapter: "4-BOB: Ahod xabar",
            topics: [
                {
                    id: "4.1",
                    title: "Ahod xabar ta'rifi va hukmi",
                    text: "Ahod xabar (Xabarul-vohid): Mashhurlik va mutavotir darajasiga yetmagan har qanday xabar. U 1 kishi, 2 kishi yoki ko'proq kishi rivoyat qilgan bo'lishi mumkin, lekin shartlarga tushmasa ahod sanaladi.\n\nHukmi: Ahod xabar qat'iy ilm bermaydi, lekin 'Amal qilishni vojib qiladi' (g'olib gumon bilan). Ya'ni, e'tiqodda shart emas, lekin fiqhiy amallarda hujjatdir."
                },
                {
                    id: "4.2",
                    title: "Ahod xabar va Hudud (Jazolar)",
                    text: "Hudud (shariat belgilagan jazolar) ahod xabar bilan sobit bo'ladimi?\n- Imom Abu Yusuf va ko'pchilik hanafiylar: Ha, sobit bo'ladi. Chunki hudud ham shariy hukmdir.\n- Imom Karkhiy: Yo'q, sobit bo'lmaydi. Chunki hadisda 'Hududlarni shubhalar bilan daf qilinglar' deyilgan, ahod xabarda esa shubha bor.\n\nKuchli qarash (Rojih): Sobit bo'ladi. Chunki 'shubha' deganda dalilning o'zidagi shubha emas, balki voqeadagi shubha nazarda tutilgan. Imom Abu Hanifa ham ba'zi o'rinlarda ahod xabar bilan hududni belgilagan."
                }
            ]
        },
        {
            chapter: "Roviylar Shartlari: 1. AQL",
            topics: [
                {
                    id: "5.1",
                    title: "Aql va Balog'at sharti",
                    text: "Hadis rivoyatida talab qilinadigan aql - bu to'liq aql bo'lib, u balog'at bilan hosil bo'ladi. Shuning uchun yosh bolaning rivoyati hujjat emas.\n\nMuhim qoida: Balog'at 'Ado etish' (gapirib berish) shartidir, 'Tahammul' (eshitib olish) sharti emas. \nMisol: Ibn Abbos, Hasan, Husayn (r.a)lar ko'p hadislarni yoshlikda eshitib, katta bo'lganda rivoyat qilishgan va ummat buni qabul qilgan. Eshitish uchun 'tamyiz' (farqlash) yoshi (taxminan 5-7 yosh) yetarli."
                }
            ]
        },
        {
            chapter: "Roviylar Shartlari: 2. ISLOM",
            topics: [
                {
                    id: "6.1",
                    title: "Islom sharti",
                    text: "Roviy musulmon bo'lishi shart. Kofirning rivoyati qabul qilinmaydi. \nSababi: Kofir yolg'on gapirmasligi mumkin, lekin unda dinga nisbatan 'dushmanlik' borligi uchun unga ishonilmaydi.\n\nBu shart ham 'Ado etish' vaqtida kerak. Agar kofir paytida eshitib, musulmon bo'lgandan keyin aytsa, qabul qilinadi (Jubayr ibn Mut'im misoli)."
                }
            ]
        },
        {
            chapter: "Roviylar Shartlari: 3. ZABT",
            topics: [
                {
                    id: "7.1",
                    title: "Zabt (Aniq saqlash) turlari",
                    text: "Zabt - hadisni to'g'ri eshitib, o'zgartirmasdan saqlash.\nIkki turi bor:\n1. Zohiriy zabt: Lafzini va lug'aviy ma'nosini bilish.\n2. Botiniy zabt: Hadisning fiqhiy ma'nosini tushunish (Faqih bo'lish).\n\nSaqlash usuli bo'yicha:\n1. Sadr zabti: Xotirada saqlash.\n2. Kitob zabti: Yozib olib saqlash.\n\nAgar roviyda g'aflat va xato ko'p bo'lsa, uning rivoyati rad etiladi."
                }
            ]
        },
        {
            chapter: "Roviylar Shartlari: 4. ADOLAT",
            topics: [
                {
                    id: "8.1",
                    title: "Adolat ta'rifi",
                    text: "Adolat - kishini taqvo va muruwwatni saqlashga undaydigan malaka (sifat). \nHadis bobida adolatli kishi:\n1. Katta gunohlardan tiyilgan.\n2. Kichik gunohlarda davomli bo'lmagan.\n3. Muruwwatni (odamgarchilikni) buzadigan ishlarni qilmagan bo'lishi kerak."
                },
                {
                    id: "8.2",
                    title: "Nabiy (s.a.v)ga yolg'on gapirgan kishi",
                    text: "Agar bir marta bo'lsa ham Rasululloh (s.a.v)ga ataylab yolg'on to'qigani aniqlansa, u kishi keyinchalik tavba qilsa ham, hanafiylarning kuchli qarashiga ko'ra uning rivoyati abadiy qabul qilinmaydi (jazo sifatida). Imom Navaviy va ba'zilar tavba qilsa qabul bo'ladi, deganlar."
                },
                {
                    id: "8.3",
                    title: "Ta'dil va Mubham roviy",
                    text: "Adolatli roviyning boshqa birovdan rivoyat qilishi o'sha kishini oqlash (ta'dil) hisoblanadimi?\n- Hanafiylarda: Agar uch asr ichida bo'lsa, bu ta'dil hisoblanadi. Undan keyin hisoblanmaydi.\n- Mubham ta'dil ('Menga ishonchli kishi aytdi' deyishi): Hanafiylarda bu ham qabul qilinadi (asosan uch asr ichida)."
                }
            ]
        },
        {
            chapter: "BID'ATCHI VA MAJHUL ROVIYLAR",
            topics: [
                {
                    id: "9.1",
                    title: "Bid'atchi roviy hukmi",
                    text: "Bid'at ikki xil: Kufrga eltuvchi va Fisqqa eltuvchi.\n1. Kufrga eltuvchi bid'at ahli (masalan, ochiq kufr): Rivoyati mutlaqo olinmaydi.\n2. Fisqqa eltuvchi (Ahli havo): \n- 1-mazhab (Saraxsiy): Qabul qilinmaydi.\n- 2-mazhab (Ibn Humom): Agar yolg'onni halol sanamasa, qabul qilinadi.\n- 3-mazhab (Ibn Hajar): Agar o'z bid'atiga da'vat qiluvchi bo'lmasa, qabul qilinadi. Imom Buxoriy xorijiylardan (Imron ibn Hattol) hadis olganlari shunga dalil."
                },
                {
                    id: "9.2",
                    title: "Majhul va Mastur roviy",
                    text: "Hanafiylar 'Majhul' deganda 3 asr ichidagi kam rivoyat qilganlarni, 'Mastur' deganda 3 asrdan keyingilarni tushunadilar (aslida ikkisi bir xil).\n\nMajhulning 5 turi va hukmi:\n1. Salaf qabul qilgan majhul: Rivoyati olinadi.\n2. Salaf sukut qilgan: Rivoyati olinadi.\n3. Ixtilof qilingan: Qiyosga mos kelsa olinadi.\n4. Salaf rad etgan: Olinmaydi.\n5. Noma'lum (hech kim bilmagan): Amal qilish vojib emas, lekin qiyosga mos kelsa joiz."
                }
            ]
        }
    ];

    // ==========================================
    // 2. DASTUR MANTIQI
    // ==========================================

    // 2.1. Chap menyuni chizish
    function renderMenu() {
        const menuContainer = document.getElementById('topicsMenu');
        
        fullData.forEach(chapter => {
            let html = `<div class="chapter-block">
                <div class="chapter-title">${chapter.chapter}</div>`;
            
            chapter.topics.forEach(topic => {
                html += `
                    <div class="topic-item">
                        <input type="checkbox" id="chk_${topic.id}" onchange="toggleTopic('${topic.id}')">
                        <label for="chk_${topic.id}" style="cursor:pointer;">${topic.title}</label>
                    </div>
                `;
            });
            
            html += `</div>`;
            menuContainer.innerHTML += html;
        });
    }

    // 2.2. Checkbox bosilganda ishlaydigan funksiya
    function toggleTopic(id) {
        const checkbox = document.getElementById(`chk_${id}`);
        const cardsArea = document.getElementById('cards-area');
        
        if (checkbox.checked) {
            // Ma'lumotni topish
            let selectedTopic = null;
            fullData.forEach(ch => {
                const found = ch.topics.find(t => t.id === id);
                if(found) selectedTopic = found;
            });

            if(selectedTopic) {
                // Yangi karta yaratish
                const card = document.createElement('div');
                card.className = 'info-card';
                card.id = `card_${id}`;
                card.innerHTML = `
                    <div class="card-header">
                        <div class="card-title">${selectedTopic.title}</div>
                        <button class="remove-btn" onclick="removeCard('${id}')">❌ O'chirish</button>
                    </div>
                    <textarea class="editable-area" id="txt_${id}">${selectedTopic.text}</textarea>
                `;
                cardsArea.appendChild(card);
                
                // Animatsiya va scroll
                card.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        } else {
            removeCard(id);
        }
    }

    // 2.3. Kartani o'chirish (X tugmasi yoki uncheck orqali)
    function removeCard(id) {
        const card = document.getElementById(`card_${id}`);
        if(card) card.remove();
        
        // Checkboxni ham unchecked qilish
        const checkbox = document.getElementById(`chk_${id}`);
        if(checkbox) checkbox.checked = false;
    }

    // 2.4. PDF Generatsiya
    function generatePDF() {
        const name = document.getElementById('inpName').value;
        const course = document.getElementById('inpCourse').value;
        
        if(!name || !course) {
            alert("Iltimos, Ism va Kursingizni kiriting!");
            return;
        }

        const cards = document.querySelectorAll('.info-card');
        if(cards.length === 0) {
            alert("Hech qanday mavzu tanlanmagan!");
            return;
        }

        // PDF kontentini tayyorlash
        document.getElementById('pdf-name').innerText = name;
        document.getElementById('pdf-course').innerText = course;
        
        const pdfBody = document.getElementById('pdf-body');
        pdfBody.innerHTML = ""; // Tozalash

        cards.forEach(card => {
            const title = card.querySelector('.card-title').innerText;
            const content = card.querySelector('textarea').value; // Tahrirlangan matnni olamiz
            
            const sectionDiv = document.createElement('div');
            sectionDiv.className = 'pdf-section';
            sectionDiv.innerHTML = `
                <h3>${title}</h3>
                <div class="pdf-content">${content}</div>
                <hr style="margin-top:10px; border:0; border-top:1px dashed #ccc;">
            `;
            pdfBody.appendChild(sectionDiv);
        });

        // PDF yaratish
        const element = document.getElementById('pdf-template');
        element.style.display = 'block'; // Vaqtincha ko'rsatish

        var opt = {
            margin:       15,
            filename:     `Mustaqil_Ish_${name}.pdf`,
            image:        { type: 'jpeg', quality: 0.98 },
            html2canvas:  { scale: 2 },
            jsPDF:        { unit: 'mm', format: 'a4', orientation: 'portrait' }
        };

        html2pdf().set(opt).from(element).save().then(() => {
            element.style.display = 'none'; // Qayta yashirish
        });
    }

    // Dastur ishga tushishi
    window.onload = renderMenu;

</script>

</body>
</html>
