<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mustaqil Ish: Usul al-Fiqh (To'liq Tahrir)</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #34495e;
            --accent: #3498db;
            --light: #f8f9fa;
            --border: #e9ecef;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f0f2f5;
            margin: 0;
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        /* Chap Panel - Menyu */
        .sidebar {
            width: 350px;
            background: white;
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            padding: 20px;
            overflow-y: auto;
            box-shadow: 2px 0 5px rgba(0,0,0,0.05);
        }

        .student-form input {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }

        .topics-tree {
            margin-top: 20px;
        }

        .chapter-title {
            font-weight: bold;
            color: var(--primary);
            margin-top: 15px;
            margin-bottom: 5px;
            padding-bottom: 5px;
            border-bottom: 2px solid var(--accent);
            font-size: 0.95em;
        }

        .topic-item {
            display: flex;
            align-items: flex-start;
            margin-bottom: 8px;
            font-size: 0.9em;
            padding: 5px;
            border-radius: 4px;
            transition: background 0.2s;
        }

        .topic-item:hover {
            background-color: var(--light);
        }

        .topic-item input {
            margin-top: 3px;
            margin-right: 10px;
        }

        /* O'ng Panel - Tahrirlash */
        .main-content {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
            background-color: #f0f2f5;
        }

        .editor-container {
            max-width: 800px;
            margin: 0 auto;
        }

        .info-card {
            background: white;
            padding: 25px;
            margin-bottom: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            border-bottom: 1px solid var(--border);
            padding-bottom: 10px;
        }

        .card-title {
            font-weight: bold;
            color: var(--primary);
            font-size: 1.1em;
        }

        .remove-btn {
            color: #e74c3c;
            cursor: pointer;
            font-size: 0.9em;
            border: none;
            background: none;
        }

        textarea.editable-area {
            width: 100%;
            min-height: 180px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-family: inherit;
            font-size: 1em;
            line-height: 1.6;
            resize: vertical;
            background-color: #fafafa;
            box-sizing: border-box;
        }

        textarea.editable-area:focus {
            outline: 2px solid var(--accent);
            background-color: white;
        }

        .action-bar {
            position: sticky;
            bottom: 20px;
            text-align: right;
            margin-top: 20px;
        }

        .btn-pdf {
            background-color: #27ae60;
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 50px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(39, 174, 96, 0.3);
            transition: transform 0.2s;
        }

        .btn-pdf:hover {
            transform: scale(1.05);
        }

        /* PDF Preview Styles (Hidden) */
        #pdf-template {
            display: none;
            padding: 40px;
            font-family: 'Times New Roman', serif;
        }
        
        .pdf-header { text-align: center; border-bottom: 2px solid black; margin-bottom: 20px; }
        .pdf-student { margin-bottom: 30px; font-weight: bold; }
        .pdf-section { margin-bottom: 20px; text-align: justify; }
        .pdf-section h3 { background-color: #eee; padding: 5px; font-size: 14pt; }
        .pdf-content { font-size: 12pt; line-height: 1.5; white-space: pre-wrap; }

    </style>
</head>
<body>

<div class="sidebar">
    <h2 style="text-align:center; color: var(--primary);">Mavzular</h2>
    
    <div class="student-form">
        <label>F.I.SH:</label>
        <input type="text" id="inpName" placeholder="Ism familiyangizni yozing">
        <label>Kurs va Guruh:</label>
        <input type="text" id="inpCourse" placeholder="Masalan: 4-A">
    </div>

    <div class="topics-tree" id="topicsMenu">
        </div>
</div>

<div class="main-content">
    <div class="editor-container">
        <h1 style="color: var(--primary); text-align: center;">Tahrirlash Maydoni</h1>
        
        <div id="cards-area">
            </div>

        <div class="action-bar">
            <button class="btn-pdf" onclick="generatePDF()">PDF YUKLAB OLISH</button>
        </div>
    </div>
</div>

<div id="pdf-template">
    <div class="pdf-header">
        <h1>MUSTAQIL ISH</h1>
        <p>Fan: Usul al-Fiqh</p>
    </div>
    <div class="pdf-student">
        <p>Talaba: <span id="pdf-name"></span></p>
        <p>Guruh: <span id="pdf-course"></span></p>
    </div>
    <div id="pdf-body"></div>
</div>

<script>
    // TO'LIQ MA'LUMOTLAR BAZASI (TARJIMA2.PDF ASOSIDA)
    const fullData = [
        {
            chapter: "1-BOB: Xabarlarning Ta'rifi va Taqsimoti",
            topics: [
                {
                    id: "1.1",
                    title: "Hanafiylarning Taqsimoti",
                    text: "Bizning hanafiy imomlarimiz Rasululloh (s.a.v)ga bog'lanish (ittisol) jihatidan xabarlarni uch qismga bo'lishgan:\n\n1. Mutavotir xabar: Surat jihatidan ham, ma'no jihatidan ham mutlaqo shubhasiz, to'liq bog'lanishga ega bo'lgan xabar.\n2. Mashhur xabar: Surat jihatidan shubha bor, chunki u sahobalar davrida ahod bo'lgan. Ammo ma'no jihatidan shubha yo'q, chunki u ikkinchi va uchinchi asrlarda (tobi'in va tobi'ut-tobi'in davrida) mutavotir bo'lib, ummat tomonidan qabul qilingan.\n3. Ahod xabar: Surat jihatidan ham, ma'no jihatidan ham shubha bor, chunki u birinchi asrda ahod bo'lgan va keyinchalik ham mutavotir darajasiga yetmagan."
                },
                {
                    id: "1.2",
                    title: "Muhaddislarning Taqsimoti",
                    text: "Muhaddislarning aksariyatiga koʻra xabarlar ikki qismga bo'linadi:\n1. Mutavotir xabar.\n2. Xabarul-vohid.\nXabarul-vohid esa o'z navbatida uch qismga bo'linadi: Mashhur, Aziz, G'arib. Hanafiylar bilan muhaddislar o'rtasidagi asosiy farq 'Mashhur' xabarni alohida mustaqil qism sifatida tan olinishidir."
                }
            ]
        },
        {
            chapter: "2-BOB: Mutavotir Xabar Tafsilotlari",
            topics: [
                {
                    id: "2.1",
                    title: "Mutavotir Ta'rifi va Hukmi",
                    text: "Lug'atda 'tavotur' so'zi narsalarning ketma-ket kelishini anglatadi. Istilohda (Ibn as-Sa'atiy): 'O'z-o'zidan ilmni hosil qiladigan jamoa xabari'.\n\nMutavotir xabarning hukmi: U zaruriy (qat'iy) ilm beradi. Uni inkor qilgan kishi kofir bo'ladi. Chunki uni inkor qilish Rasululloh (s.a.v)ni rad etish bilan tengdir."
                },
                {
                    id: "2.2",
                    title: "Mutavotirning Uchta Sharti",
                    text: "Hanafiy muhaqqiqlarga ko'ra mutavotir bo'lishi uchun quyidagi shartlar lozim:\n1. Ko'plik: Roviylar soni shunchalik ko'p bo'lishi kerakki, aql ularning yolg'on ustida kelishib olishini imkonsiz deb bilsin.\n2. Uzluksizlik: Bu ko'plik barcha tabaqalarda (sahoba, tobi'in, tobi'ut-tobi'in) mavjud bo'lishi shart.\n3. Sezgiga asoslanish: Xabar aqliy xulosa emas, balki ko'rish yoki eshitish kabi hissiyotga asoslangan bo'lishi kerak."
                }
            ]
        },
        {
            chapter: "3-BOB: Mashhur Xabar Tafsilotlari",
            topics: [
                {
                    id: "3.1",
                    title: "Mashhur Xabar va Uch Asr Qoidasi",
                    text: "Mashhur xabar - birinchi asrda (sahobalar davrida) ahod bo'lib, keyingi ikki asrda mutavotir bo'lgan xabardir. \n\nHanafiylarda uch asr chegarasi:\n1. Sahobalar asri (110 h.y.gacha).\n2. Tobi'inlar asri (180 h.y.gacha).\n3. Tobi'ut-tobi'inlar asri (220 h.y.gacha).\nUch asrdan keyingi mashhurlik e'tiborga olinmaydi."
                },
                {
                    id: "3.2",
                    title: "Mashhur Xabarning Hukmi",
                    text: "Mashhur xabar 'tuma'nina' (xotirjamlik) beradigan ilm hosil qiladi. Uni inkor qilgan kishi kofir bo'lmaydi, balki adashgan (zall) deb ataladi. U bilan Qur'onning umumiy hukmlarini xoslash (taxsis) mumkin."
                }
            ]
        },
        {
            chapter: "4-BOB: Ahod Xabarlar va Hudud",
            topics: [
                {
                    id: "4.1",
                    title: "Ahod Xabar Hukmi",
                    text: "Ahod xabar (Xabarul-vohid) qat'iy ilm bermaydi, lekin amal qilishni vojib qiladi. Shariat amallarida u dalil sifatida qabul qilinadi."
                },
                {
                    id: "4.2",
                    title: "Hududlarda Ahod Xabarning O'rni",
                    text: "Hudud (jazolar) ahod xabar bilan sobit bo'ladimi? \n- Imom Abu Yusuf va ko'pchilik: Sobit bo'ladi, chunki u ham shariy hukmdir.\n- Imom Karkhiy: Sobit bo'lmaydi, chunki hadisda hududlarni shubha bilan qaytarish buyurilgan, ahodda esa shubha bor. \nLekin fatvo Abu Yusuf qarashiga ko'ra berilgan."
                }
            ]
        },
        {
            chapter: "5-BOB: Roviylar Shartlari (Aql, Islom, Zabt)",
            topics: [
                {
                    id: "5.1",
                    title: "Aql va Balog'at Sharti",
                    text: "Rivoyatni yetkazish (ado etish) vaqtida roviy oqil va balog'atga yetgan bo'lishi shart. Ammo yosh bolaning eshitgan (tahammul) hadislari u katta bo'lganda rivoyat qilsa qabul qilinadi."
                },
                {
                    id: "5.2",
                    title: "Islom va Zabt Shartlari",
                    text: "Islom: Roviy musulmon bo'lishi shart. Kofirning rivoyati dushmanlik gumoni borligi uchun rad etiladi.\nZabt: Bu hadisni qanday eshitgan bo'lsa, shunday saqlashdir. Zabt ikki xil bo'ladi: Sadr (xotira) zabti va Kitob zabti. Agar roviy ko'p xato qilsa yoki g'ofil bo'lsa, rivoyati olinmaydi."
                }
            ]
        },
        {
            chapter: "6-BOB: Adolat va Majhul Roviylar",
            topics: [
                {
                    id: "6.1",
                    title: "Adolat Sifati va Yolg'on",
                    text: "Adolat - katta gunohlardan tiyilish va muruwwatni saqlashdir. Rasululloh (s.a.v)ga qasddan yolg'on to'qigan kishi tavba qilsa ham, uning rivoyati abadiy qabul qilinmaydi (Hanafiylarning qat'iy qarashi)."
                },
                {
                    id: "6.2",
                    title: "Majhul va Mastur Roviylar",
                    text: "Majhul roviy - uch asr (salaf) davrida yashagan, lekin rivoyati kam kishi. Mastur - uch asrdan keyingi adolati noma'lum kishi. \n\nMajhulning 5 turi:\n1. Salaf qabul qilgan: Qabul qilinadi.\n2. Salaf sukut qilgan: Qabul qilinadi.\n3. Ixtilofli: Qiyosga mos bo'lsa olinadi.\n4. Salaf rad etgan: Olinmaydi.\n5. Hech kim tanimagan: Olinmaydi."
                },
                {
                    id: "6.3",
                    title: "Bid'atchi Roviy Hukmi",
                    text: "Agar bid'at kufrga eltuvchi bo'lsa - rad etiladi. Agar fisq bo'lsa: \n1. Saraxsiy: Rad etiladi.\n2. Ibn Humom: Yolg'onni halol sanamasa olinadi.\n3. Ibn Hajar: O'z bid'atiga da'vat qilmasa olinadi."
                }
            ]
        }
    ];

    // INIZIALIZATSIYA
    function renderMenu() {
        const menuContainer = document.getElementById('topicsMenu');
        fullData.forEach(chapter => {
            let html = `<div class="chapter-block">
                <div class="chapter-title">${chapter.chapter}</div>`;
            chapter.topics.forEach(topic => {
                html += `<div class="topic-item">
                    <input type="checkbox" id="chk_${topic.id}" onchange="toggleTopic('${topic.id}')">
                    <label for="chk_${topic.id}">${topic.title}</label>
                </div>`;
            });
            html += `</div>`;
            menuContainer.innerHTML += html;
        });
    }

    function toggleTopic(id) {
        const checkbox = document.getElementById(`chk_${id}`);
        const cardsArea = document.getElementById('cards-area');
        if (checkbox.checked) {
            let topic = null;
            fullData.forEach(ch => {
                const found = ch.topics.find(t => t.id === id);
                if(found) topic = found;
            });
            if(topic) {
                const card = document.createElement('div');
                card.className = 'info-card';
                card.id = `card_${id}`;
                card.innerHTML = `
                    <div class="card-header">
                        <div class="card-title">${topic.title}</div>
                        <button class="remove-btn" onclick="removeCard('${id}')">❌</button>
                    </div>
                    <textarea class="editable-area" id="txt_${id}">${topic.text}</textarea>`;
                cardsArea.appendChild(card);
                card.scrollIntoView({ behavior: 'smooth' });
            }
        } else {
            removeCard(id);
        }
    }

    function removeCard(id) {
        const card = document.getElementById(`card_${id}`);
        if(card) card.remove();
        const chk = document.getElementById(`chk_${id}`);
        if(chk) chk.checked = false;
    }

    function generatePDF() {
        const name = document.getElementById('inpName').value;
        const course = document.getElementById('inpCourse').value;
        if(!name || !course) return alert("Ism va kursni kiriting!");
        
        document.getElementById('pdf-name').innerText = name;
        document.getElementById('pdf-course').innerText = course;
        const pdfBody = document.getElementById('pdf-body');
        pdfBody.innerHTML = "";

        document.querySelectorAll('.info-card').forEach(card => {
            const title = card.querySelector('.card-title').innerText;
            const content = card.querySelector('textarea').value;
            pdfBody.innerHTML += `<div class="pdf-section"><h3>${title}</h3><div class="pdf-content">${content}</div></div>`;
        });

        const element = document.getElementById('pdf-template');
        element.style.display = 'block';
        html2pdf().set({ margin: 15, filename: `Ish_${name}.pdf`, html2canvas: { scale: 2 }, jsPDF: { unit: 'mm', format: 'a4' } })
        .from(element).save().then(() => { element.style.display = 'none'; });
    }

    window.onload = renderMenu;
</script>
</body>
</html>
