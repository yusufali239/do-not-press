<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Usul al-Fiqh: Mustaqil Ish Platformasi</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #34495e;
            --accent: #3498db;
            --light: #f8f9fa;
            --border: #e9ecef;
            --success: #27ae60;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f0f2f5;
            margin: 0;
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        /* Chap Panel - Menyu */
        .sidebar {
            width: 380px;
            background: white;
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            padding: 20px;
            overflow-y: auto;
            box-shadow: 2px 0 5px rgba(0,0,0,0.05);
        }

        .student-form {
            background: var(--light);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .student-form label { font-size: 12px; font-weight: bold; color: var(--secondary); }

        .student-form input {
            width: 100%;
            padding: 10px;
            margin: 5px 0 15px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }

        .chapter-title {
            font-weight: bold;
            color: var(--primary);
            margin-top: 15px;
            padding: 5px 0;
            border-bottom: 2px solid var(--accent);
            font-size: 14px;
            text-transform: uppercase;
        }

        .topic-item {
            display: flex;
            align-items: flex-start;
            margin: 8px 0;
            font-size: 13px;
            padding: 5px;
            border-radius: 4px;
            transition: background 0.2s;
            cursor: pointer;
        }

        .topic-item:hover { background: var(--light); }

        .topic-item input { margin-right: 10px; margin-top: 2px; }

        /* O'ng Panel - Ish joyi */
        .main-content {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
            background-color: #f0f2f5;
        }

        .editor-container { max-width: 850px; margin: 0 auto; }

        .info-card {
            background: white;
            padding: 25px;
            margin-bottom: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            border-left: 5px solid var(--accent);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .card-title { font-weight: bold; color: var(--primary); }

        .remove-btn { color: #e74c3c; cursor: pointer; border: none; background: none; font-size: 12px; }

        textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 15px;
            line-height: 1.6;
            font-family: 'Times New Roman', serif;
            resize: vertical;
            box-sizing: border-box;
            background: #fdfdfd;
        }

        /* Xulosa qismi */
        .summary-card {
            background: #eef7ff;
            border-left: 5px solid #2980b9;
        }

        .action-bar {
            position: sticky;
            bottom: 0;
            background: rgba(240, 242, 245, 0.9);
            padding: 20px 0;
            text-align: right;
        }

        .btn-pdf {
            background-color: var(--success);
            color: white;
            padding: 15px 35px;
            border: none;
            border-radius: 50px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(39, 174, 96, 0.3);
        }

        /* PDF Preview Modal */
        #pdf-render-area {
            display: none;
            background: white;
            padding: 50px;
            color: black;
            font-family: 'Times New Roman', serif;
        }
        .pdf-h1 { text-align: center; text-transform: uppercase; border-bottom: 2px solid black; }
        .pdf-meta { margin: 20px 0; font-weight: bold; font-size: 14pt; }
        .pdf-section { margin-bottom: 25px; text-align: justify; }
        .pdf-section h3 { text-decoration: underline; font-size: 16pt; margin-bottom: 10px; }
        .pdf-text { font-size: 12pt; white-space: pre-wrap; }
    </style>
</head>
<body>

<div class="sidebar">
    <h2 style="text-align:center; color: var(--primary);">Mavzular Ro'yxati</h2>
    
    <div class="student-form">
        <label>TALABA F.I.SH:</label>
        <input type="text" id="stuName" placeholder="Masalan: Alimov Sardor">
        <label>KURS VA GURUH:</label>
        <input type="text" id="stuCourse" placeholder="Masalan: 4-A">
    </div>

    <div id="menuContent"></div>
</div>

<div class="main-content">
    <div class="editor-container">
        <h1 style="text-align:center; color: var(--primary);">Mustaqil ishni shakllantirish</h1>
        <p style="text-align:center; color: #666;">Chapdan mavzuni tanlang, matnni tahrirlang va eng oxirida xulosa yozing.</p>
        
        <div id="workingArea">
            </div>

        <div class="info-card summary-card">
            <div class="card-header">
                <div class="card-title">UMUMIY XULOSA (MUSTAQIL ISH YUZASIDAN)</div>
            </div>
            <textarea id="finalSummary" placeholder="Ushbu mustaqil ish bo'yicha o'z shaxsiy xulosangizni yozing..."></textarea>
        </div>

        <div class="action-bar">
            <button class="btn-pdf" onclick="generatePDF()">PDF SIFATIDA YUKLASH</button>
        </div>
    </div>
</div>

<div id="pdf-render-area">
    <div class="pdf-h1">Mustaqil Ish</div>
    <div style="text-align:center; font-weight:bold;">Mavzu: Usul al-Fiqh va Roviylar shartlari</div>
    
    <div class="pdf-meta">
        <p>Bajardi: <span id="p-name"></span></p>
        <p>Guruh: <span id="p-course"></span></p>
        <p>Sana: <span id="p-date"></span></p>
    </div>

    <div id="p-body"></div>
</div>

<script>
    // PDF dagi barcha ma'lumotlar bazasi
    const dataSource = [
        {
            chapter: "1. XABARLARNING BO'LINISHI",
            items: [
                { id: "h1", title: "Hanafiylar taqsimoti", text: "Hanafiy imomlarimiz Rasululloh (s.a.v)ga bog'lanish jihatidan xabarlarni 3 ga bo'lishgan: 1. Mutavotir (shubhasiz to'liq bog'lanish). 2. Mashhur (sahobalar davrida ahod, keyin mutavotir bo'lgan). 3. Ahod (surat va ma'noda shubha bor)." },
                { id: "h2", title: "Muhaddislar taqsimoti", text: "Muhaddislar soniga qarab 2 ga bo'lishadi: Mutavotir va Ahod. Ahod esa: Mashhur, Aziz va G'aribga bo'linadi. Hanafiylarda 'Mashhur' alohida daraja hisoblanadi." }
            ]
        },
        {
            chapter: "2. MUTAVOTIR XABAR",
            items: [
                { id: "m1", title: "Mutavotir ta'rifi va shartlari", text: "Ta'rifi: O'z-o'zidan ilmni hosil qiladigan jamoa xabari. Shartlari: 1. Ko'plik (yolg'on ustida kelishish imkonsiz). 2. Barcha tabaqalarda bo'lishi (3 asr). 3. Hissiyotga (sezgi) asoslanishi." },
                { id: "m2", title: "Mutavotir hukmi", text: "Zaruriy qat'iy ilm beradi. Uni inkor qilgan kishi kofir bo'ladi. Chunki u Rasulullohni to'g'ridan-to'g'ri inkor qilish bilan barobar." }
            ]
        },
        {
            chapter: "3. MASHHUR XABAR",
            items: [
                { id: "ms1", title: "Mashhur xabar xususiyatlari", text: "Birinchi asrda ahod bo'lib, ikkinchi va uchinchi asrda mutavotir bo'lgan. Hukmi: Mutavotirdan past, ahoddan yuqori. Tuma'nina (xotirjamlik) beradi. Uni inkor qilgan kishi adashgan bo'ladi, lekin kofir bo'lmaydi." }
            ]
        },
        {
            chapter: "4. ROVIYLAR SHARTLARI",
            items: [
                { id: "r1", title: "Aql va Balog'at", text: "Rivoyatni yetkazish (ado) vaqtida roviy oqil va balog'atga yetgan bo'lishi shart. Ammo yoshlikda (tamyiz yoshida) eshitgan hadisini balog'atda aytsa qabul qilinadi." },
                { id: "r2", title: "Islom va Zabt", text: "Roviy musulmon bo'lishi va zabt (aniq saqlash) sifatiga ega bo'lishi shart. Zabt ikki xil: Sadr (xotira) va Kitob (yozuv) zabti. Faqih roviyning zabti ustunroqdir." },
                { id: "r3", title: "Adolat", text: "Taqvoni saqlash, katta gunohlardan tiyilish va muruwwatni saqlash. Rasulullohga yolg'on to'qigan kishi tavba qilsa ham rivoyati abadiy olinmaydi." }
            ]
        },
        {
            chapter: "5. MAJHUL VA BID'ATCHI ROVIY",
            items: [
                { id: "mj1", title: "Majhul roviy turlari", text: "Hanafiylarda 3 asr ichidagi majhulning 5 turi bor: 1. Salaf qabul qilgan. 2. Salaf sukut qilgan. 3. Ixtilofli. 4. Salaf rad etgan. 5. Umuman noma'lum. Har birining o'z hukmi bor." },
                { id: "bd1", title: "Bid'atchi rivoyati", text: "Kufrga eltuvchi bid'at bo'lsa rad etiladi. Agar fisq bo'lsa va yolg'onni halol sanamasa, ba'zi shartlar bilan qabul qilinadi. Masalan, Imom Buxoriy ba'zi ahli havolardan hadis olganlar." }
            ]
        }
    ];

    // Menyuni chizish
    function buildMenu() {
        const container = document.getElementById('menuContent');
        dataSource.forEach(chap => {
            let html = `<div class="chapter-title">${chap.chapter}</div>`;
            chap.items.forEach(item => {
                html += `
                    <div class="topic-item">
                        <input type="checkbox" id="chk_${item.id}" onchange="toggleItem('${item.id}')">
                        <label for="chk_${item.id}">${item.title}</label>
                    </div>`;
            });
            container.innerHTML += html;
        });
    }

    // Mavzuni ish joyiga chiqarish yoki o'chirish
    function toggleItem(id) {
        const checkbox = document.getElementById(`chk_${id}`);
        const area = document.getElementById('workingArea');
        
        if (checkbox.checked) {
            let itemData = null;
            dataSource.forEach(c => {
                const found = c.items.find(i => i.id === id);
                if(found) itemData = found;
            });

            const card = document.createElement('div');
            card.className = 'info-card';
            card.id = `card_${id}`;
            card.innerHTML = `
                <div class="card-header">
                    <span class="card-title">${itemData.title}</span>
                    <button class="remove-btn" onclick="removeItem('${id}')">O'chirish ‚ùå</button>
                </div>
                <textarea id="editor_${id}">${itemData.text}</textarea>
            `;
            area.appendChild(card);
            card.scrollIntoView({behavior: 'smooth', block: 'center'});
        } else {
            const card = document.getElementById(`card_${id}`);
            if(card) card.remove();
        }
    }

    function removeItem(id) {
        document.getElementById(`chk_${id}`).checked = false;
        toggleItem(id);
    }

    // PDF yaratish va Preview
    function generatePDF() {
        const name = document.getElementById('stuName').value;
        const course = document.getElementById('stuCourse').value;
        const summary = document.getElementById('finalSummary').value;
        
        if(!name || !course) return alert("Iltimos, ismingiz va kursingizni kiriting!");

        // Preview ma'lumotlarini tayyorlash
        document.getElementById('p-name').innerText = name;
        document.getElementById('p-course').innerText = course;
        document.getElementById('p-date').innerText = new Date().toLocaleDateString();
        
        const pBody = document.getElementById('p-body');
        pBody.innerHTML = "";

        // Tanlangan barcha matnlarni yig'ish
        const cards = document.querySelectorAll('#workingArea .info-card');
        cards.forEach(card => {
            const title = card.querySelector('.card-title').innerText;
            const content = card.querySelector('textarea').value;
            pBody.innerHTML += `<div class="pdf-section"><h3>${title}</h3><div class="pdf-text">${content}</div></div>`;
        });

        // Xulosani qo'shish
        if(summary) {
            pBody.innerHTML += `<div class="pdf-section"><h3>MUSTAQIL ISH YUZASIDAN XULOSA</h3><div class="pdf-text">${summary}</div></div>`;
        }

        // PDFni generatsiya qilish
        const element = document.getElementById('pdf-render-area');
        element.style.display = 'block';

        const opt = {
            margin: 15,
            filename: `Mustaqil_Ish_${name}.pdf`,
            image: { type: 'jpeg', quality: 0.98 },
            html2canvas: { scale: 2 },
            jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
        };

        html2pdf().set(opt).from(element).save().then(() => {
            element.style.display = 'none';
        });
    }

    window.onload = buildMenu;
</script>

</body>
</html>
